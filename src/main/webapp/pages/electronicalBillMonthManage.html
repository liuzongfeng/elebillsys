<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>月度账单管理页面</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="文件上传页面">
    <meta name="author" content="刘宗峰">

    <!-- Le styles -->
    <link href="../bootstrap/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <link href="../bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="../bootstrap/css/datetimepicker.css" rel="stylesheet">
 </head>
  <body>
  <div id="manageId">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">月度账单管理</a>
          <div class="nav-collapse collapse">
            <p class="navbar-text pull-right">
              Logged in as <a href="#" class="navbar-link">Username</a>
            </p>
            <ul class="nav">
              <li class="active"><a href="index.html">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              
              <li class="nav-header">商务人员</li>
              <li><a href="electronicalBillIssue.html">账单期数管理</a></li>
              <li class="active"><a href="electronicalBillMonthManage.html">月度账单管理</a></li>
              <li><a href="electronicalBillIssue.html">月度账单查询</a></li>
              <li><a href="electronicalBillDetail.html">月度账单明细</a></li>
              
              <li class="nav-header">对账渠道</li>
              <li><a href="electronicalBillForOther.html">对账账单管理</a></li>
              <li><a href="electronicalBillToCheck.html">对账账单核对</a></li>
              <li><a href="electronicalBillToSearch.html">对账账单查询</a></li>
              <li><a href="electronicalBillOtherDetail.html">对账账单明细</a></li>
              
              <li class="nav-header">商务结算人员</li>
              <li><a href="electronicalBillTempManage.html">临时账单管理</a></li>
              <li><a href="electronicalBillTempEdit.html">临时账单编制</a></li>
              <li><a href="electronicalBillTempDetail.html">临时账单明细</a></li>
              
              <li><a href="#"></a></li>
              <li><a href="#"></a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <!-- 添加账单期数的操作内容 -->
        <div class="span9">
          
        
          	
          <!-- 列表展示区 -->
          	 <div class="table-responsive" >
				<table class="table" style="margin-top:30px;">
					<caption></caption>
					<thead>
						<tr>
						    
							<th><h3>数据表</h3><h4>请上传{{issueName}}期账单基础数据</h4></th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr>
						    
							<td><span>对账导出_应收净额表</span>           &nbsp; &nbsp; &nbsp;<span style="float:right;margin-right:200px;">{{netsumMessage}}&nbsp;&nbsp;{{netsumCount}}</span></td>
							<td><button id="file_netsum" @click="changeFileType($event)" class="btn" type="button" data-toggle="modal" data-target="#uploadAccountLimit">上传</button></td>
						</tr>
						<tr>
						    
							<td><span>对账导出_销售业务统计总表</span>    &nbsp; &nbsp; &nbsp;<span style="float:right;margin-right:200px;">{{statisticMessage}}&nbsp;&nbsp;{{statisticCount}}</span></td>
							<td><button id="file_statistic" @click="changeFileType($event)" class="btn" type="button" data-toggle="modal" data-target="#uploadAccountLimit">上传</button></td>
						</tr>
						<tr>
						    
							<td><span>对账导出_留返利往来清单</span>         &nbsp; &nbsp; &nbsp;<span style="float:right;margin-right:200px;">{{rebateMessage}}&nbsp;&nbsp;{{rebateCount}}</span></td>
							<td><button id="file_rebate" @click="changeFileType($event)" class="btn" type="button" data-toggle="modal" data-target="#uploadAccountLimit">上传</button></td>
						</tr>
						<tr>
							<td><span>对账导出_未核销的留返利</span>            &nbsp; &nbsp; &nbsp;<span style="float:right;margin-right:200px;">{{unrebateMessage}}&nbsp;&nbsp;{{unrebateCount}}</span></td>
							<td><button id="file_unrebate" @click="changeFileType($event)" class="btn" type="button" data-toggle="modal" data-target="#uploadAccountLimit">上传</button></td>
						</tr>
						<tr>
							<td><span>预收表</span>                  &nbsp; &nbsp; &nbsp;<span style="float:right;margin-right:200px;">{{yushouMessage}}&nbsp;&nbsp;{{yushouCount}}</span></td>
							<td><button id="file_yushou" @click="changeFileType($event)" class="btn" type="button" data-toggle="modal" data-target="#uploadAccountLimit">上传</button></td>
						</tr>
						<tr>
							<td><span>对账导出_资金占用费计算表  </span>            &nbsp; &nbsp; &nbsp;<span style="float:right;margin-right:200px;">{{useamountMessage}}&nbsp;&nbsp;{{useamountCount}}</span></td>
							<td><button id="file_useamount" @click="changeFileType($event)" class="btn" type="button" data-toggle="modal" data-target="#uploadAccountLimit">上传</button></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
					</tbody>
			</table>
			
		</div>
          
          <!-- 模态框 -->
         <!--上传文件model-->
	<div id="uploadAccountLimit" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="myModalLabel">上传{{upfileName}}</h3>
	  </div>
	  <div class="modal-body">
		  <div class="bs-docs-example" id="uploadpriceForm">
			  <form id="uploadexcel" align="center"  action="#" method="post" enctype="multipart/form-data">
					<h5 id="meg"></h5>
					
					 <div class="control-group">
					    <label class="control-label" for="inputPassword"></label>
					    <div class="controls">
					     <input class="startDate" size="16" type="text" placeholder="2017-01-01" v-model="issueStartDate" readonly="readonly"/>至
					     <input class="startDate" size="16" type="text" placeholder="2017-03-31" v-model="issueEndDate" readonly="readonly"/>
					    </div>
					 </div>
					
					
				
					
					<input id="lefile" type="file" name="upfile" style="display: none;">
					 
						<div class="input-append" style="margin-top:30px;">
							<input id="photoCover" type="text" class="input-large">
							<a class="btn btn-success" @click="uploadFileForm_fn"><i class="icon-white icon-folder-open"></i> 选择文件</a>
						
						</div>
			  
			 
			  </form>
		  </div>
	  </div>
	  <div class="modal-footer" id="message_buttons">
		<button id="upload_btn" class="btn btn-primary" @click="uploadFile_fn">上传</button>
		<button id="message_button_no" class="btn btn-primary" data-dismiss="modal" aria-hidden="true">关闭</button>
	  </div>
	</div>
        </div><!--/span-->
        
      </div><!--/row-->

      <hr>

      <footer>
        <p>&copy; mis组  2017</p>
      </footer>

    </div><!--/.fluid-container-->
</div>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
     <script type="text/javascript" src="../js/basePath.js"></script>
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script src="../bootstrap/js/bootstrap-datetimepicker.min.js"></script>
     <script src="../bootstrap/js/bootstrap-datetimepicker.fr.js"></script>
    <script src="../bootstrap/js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script type="text/javascript" src="../js/vue.js"></script>
    <script type="text/javascript" src="../js/moment.js"></script>
    <script type="text/javascript" src="../js/axios.min.js"></script>
    <script type="text/javascript">
    
    window.onload = function(){
    	var data_manage = {
    			issueName : "",
    			issueId : null,
    			issueStartDate : null,
    			issueEndDate : null,
    			issueObjId : null,
    			upfileType : "",
    			upfileName : "",
    			netsumMessage : "",
    			netsumCount : "",
    			statisticMessage : "",
    			statisticCount : "",
    			rebateMessage : "",
    			rebateCount : "",
    			unrebateMessage : "",
    			unrebateCount : "",
    			yushouMessage : "",
    			yushouCount : "",
    			useamountMessage : "",
    			useamountCount : ""
    	}
    	
    	var manageVm = new Vue({
    		el : "#manageId",
    		data : data_manage,
    		methods : {
    			//改变文件类型
    			changeFileType : function(event){
    				manageVm.upfileType = $(event.target).prop("id");
    				manageVm.upfileName = "";
    				manageVm.upfileName = $($(event.target).parent().prev().children()[0]).text();
    			},
    			
    			//文件上传
    			uploadFile_fn : function(){
    				//数据
    				var formdata = new FormData($("#uploadexcel")[0]);
    				formdata.append('upfile',$("#uploadexcel")[0]);
    				formdata.append('issueStartDate',manageVm.issueStartDate);
    				formdata.append('issueEndDate',manageVm.issueEndDate);
    				formdata.append('issueObjId',manageVm.issueObjId);
    				formdata.append('upfileType',manageVm.upfileType);
    				
    				
    				//请求
    				axios({
    					url : base_path+'/miselebill/uploadBillFile',
    					method : 'post',
    					data : formdata,
    					headers : {'Content-Type' : 'multipart/form-data'}
    					
    				}).then(function(response){
    					//1.清空表单内容
    					$('input[id=lefile]').val("");
    					$('#photoCover').val("");
    					
    					//2.关闭模态框
    					$('#uploadAccountLimit').modal('hide')
    					//3.展示上传成功
    					if(null != response.data){
    						if("file_netsum" == response.data){
    							manageVm.netsumMessage = "上传成功";
    							manageVm.netsumCount = "";
    						}else if("file_statistic" == response.data){
    							manageVm.statisticMessage = "上传成功";
    							manageVm.statisticCount = "";
    						}else if("file_rebate" == response.data){
    							manageVm.rebateMessage = "上传成功";
    							manageVm.rebateCount = "";
    						}else if("file_unrebate" == response.data){
    							manageVm.unrebateMessage = "上传成功";
    							manageVm.unrebateCount ="";
    						}else if("file_yushou" == response.data){
    							manageVm.yushouMessage = "上传成功";
    							manageVm.yushouCount = "";
    						}else if("file_useamount" == response.data){
    							manageVm.useamountMessage = "上传成功";
    							manageVm.useamountCount = "";
    						}else{
    							
    						}
    						window.location.reload();
    					}
    					
    				}).catch(function(error){
    					//1.清空表单内容
    					$('input[id=lefile]').val("");
    					$('#photoCover').val("");
    					var status_ = error.response.status;
    					var message_ = error.response.data.message;
    					message_ = encodeURI(encodeURI(message_));  
    					window.location.href = "error.html?status="+status_+"&message="+message_;
    				}) 
    			},
    			
    			//处理上传文件控件样式
    			uploadFileForm_fn : function(){
			    	 $('input[id=lefile]').click();
			    	 var i =0;
			    	 var aaa = window.setInterval(function(){
			    		 var fileValue = document.getElementById("lefile").value ;
			    		 if(null != fileValue){
			    			//将输入框值添加到控件
			              	$('#photoCover').val(fileValue);
			    			i = i+1;
			    		 }
			    	 },"500");
			    	 
			    	if(i == 1){
			    		window.clearInterval(aaa);
			    	}
			    } 
    		},
    		//过滤器
      	  	filters:{
      	  		
      	  	},
			created : function(){
      	  		
      	  	},
			updated : function(){
				
			    	
      	  	}
    	});
    	
    	//获得未发布的期数
    	var obtainIssueOne = function(){
    		axios.get( base_path+'/miselebill/searchEbIssue')
    		      .then(function(response){
    		    	  manageVm.issueObjId = response.data.issue.id;
    		    	  manageVm.issueName =  response.data.issue.issueName;
    		    	  manageVm.issueStartDate = moment(new Date(response.data.issue.issueStartDate)).format("YYYY-MM-DD") ;
    		    	  manageVm.issueEndDate = moment(new Date(response.data.issue.issueEndDate)).format("YYYY-MM-DD") ;
    		    	  //---处理上传相关
    		    	  var c1 = response.data.file_netsum;
    		    	  var c2 = response.data.file_rebate;
    		    	  var c3 = response.data.file_unrebate;
    		    	  var c4 = response.data.file_statistic;
    		    	  var c5 = response.data.file_yushou;
    		    	  var c6 = response.data.file_useamount;
    		    	  if(null != c1 && c1 > 0){manageVm.netsumMessage = "成功上传";manageVm.netsumCount = c1 +"条"}
    		    	  if(null != c2 && c2 > 0){manageVm.rebateMessage = "成功上传";manageVm.rebateCount = c2 +"条"}
    		    	  if(null != c3 && c3 > 0){manageVm.unrebateMessage = "成功上传";manageVm.unrebateCount = c3 +"条"}
    		    	  if(null != c4 && c4 > 0){manageVm.statisticMessage = "成功上传";manageVm.statisticCount = c4 +"条"}
    		    	  if(null != c5 && c5 > 0){manageVm.yushouMessage = "成功上传";manageVm.yushouCount = c5 +"条"}
    		    	  if(null != c6 && c6 > 0){manageVm.useamountMessage = "成功上传";manageVm.useamountCount = c6 +"条"}
    		    	  
    		      })
    		      .catch(function(error){
    		    	  
    		      })
    	};
    	obtainIssueOne();
    	$('#uploadAccountLimit').on('hide.bs.modal',
    		    function() {
		    		//1.清空表单内容
					$('input[id=lefile]').val("");
					$('#photoCover').val("");
    		    })

    	
    }
    
    
    
   
    </script>
    
  </body>
</html>